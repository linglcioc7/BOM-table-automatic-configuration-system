# BOM生成系统

一个基于Python Flask的自动BOM（物料清单）表生成系统，支持完整的配方管理和Excel导入导出功能。

## 系统特点

- 🚀 **自动化生成**：根据配方自动生成标准格式的BOM表
- 📊 **配方管理**：支持配方的增删改查、导入导出
- 📄 **Excel导入导出**：支持配方模板下载、批量导入、配方导出
- 🌐 **Web界面**：基于浏览器的友好用户界面
- 🔧 **易于维护**：配方信息可随时更新和管理

## 系统架构

- **后端**：Python Flask + SQLAlchemy + SQLite
- **前端**：HTML + JavaScript + Bootstrap 5
- **数据库**：SQLite（轻量级，无需额外安装）
- **文件格式**：Excel (.xlsx)

## 安装和运行

### 1. 环境要求
- Python 3.7+
- pip包管理器

### 2. 安装依赖
```bash
pip install -r requirements.txt
```

### 3. 运行系统
```bash
python app.py
```

### 4. 访问系统
- 主页面：http://localhost:5000
- 管理页面：http://localhost:5000/admin

## 功能说明

### 主要功能

#### 1. BOM表生成
- **父项物料号**：自制产成品的物料编码
- **物料名称**：父件物料的描述名称
- **基本数量**：BOM产品的基本数量
- **基本单位**：BOM产品的基本单位（EA、KG、M等）
- **配方选择**：选择对应的生产配方

#### 2. 配方管理
- **配方添加**：通过Web界面添加新配方
- **配方编辑**：修改现有配方的名称、描述和配方项
- **配方删除**：软删除配方（设置is_active为False）
- **配方查看**：查看配方的详细信息和配方项列表
- **配方导入**：从Excel文件批量导入配方数据
- **配方导出**：将配方导出为Excel格式文件
- **模板下载**：下载标准配方导入模板

#### 3. 行号编码规则
- 行号格式：0010、0020、0030...（4位数字文本格式）
- 系统自动生成，用户可手动调整
- 支持自定义行号输入

### BOM表字段说明

生成的BOM表包含以下17列：

| 列 | 字段名称 | 说明 | 默认值 |
|---|----------|------|--------|
| A | 字段名称 | 字段填写说明 | 空 |
| B | 工厂 | 4位工厂代码 | P060 |
| C | BOM可选文本 | 不同可选BOM的文本描述 | 配方描述 |
| D | 父项物料号 | 自制产成品 | 用户输入 |
| E | 物料名称 | 父件物料描述 | 用户输入 |
| F | 生效日期 | BOM生效的开始日期 | 空 |
| G | BOM用途 | 用途标识 | 1 |
| H | 可选BOM | BOM编号（01、02、03...） | 自动生成 |
| I | BOM状态 | 状态标识 | 01 |
| J | 基本数量 | BOM产品的基本数量 | 用户输入 |
| K | 基本单位 | BOM产品的基本单位 | 用户输入 |
| L | 行项目号 | 子件行项目编号 | 配方定义（0010、0020...） |
| M | 项目类别 | 固定值"L"，虚拟件为"N" | L |
| N | 子项物料号 | 组件项的物料编码 | 配方定义 |
| O | 子项物料描述 | 子件物料描述 | 配方定义 |
| P | 子项数量 | 子件物料的用量 | 配方定义 |
| Q | 子项单位 | 子件物料的计量单位 | 配方定义 |

## 使用流程

### 1. 系统初始化
首次运行系统会自动创建示例数据：
- 示例配方：标准配方1（包含2个配方项）

### 2. 配方管理
1. 访问管理页面：`/admin`
2. **添加配方**：点击"添加配方"按钮，填写配方信息
3. **编辑配方**：点击"编辑"按钮修改现有配方
4. **删除配方**：点击"删除"按钮删除配方
5. **导入配方**：下载模板，填写数据后上传
6. **导出配方**：将配方导出为Excel文件

### 3. 生成BOM表
1. 在主页面填写BOM信息
2. 选择对应的配方
3. 点击"生成BOM表"
4. 系统自动生成Excel文件并下载

## 配方导入导出

### 导入模板格式
Excel模板包含以下列：
- **行号**：配方项的行号（如0010、0020）
- **物料编码**：物料的编码
- **物料名称**：物料的名称
- **数量**：物料的数量
- **单位**：物料的单位（EA、KG、M等）
- **类别**：项目类别（L或N）

### 导入步骤
1. 下载配方导入模板
2. 按照模板格式填写数据
3. 在管理页面点击"导入配方"
4. 填写配方名称和描述
5. 选择Excel文件并上传

### 导出功能
- 支持将单个配方导出为Excel文件
- 导出文件包含配方基本信息和配方项列表
- 便于配方数据的备份和分享

## 局域网部署

### 1. 修改运行配置
在`app.py`中修改运行参数：
```python
app.run(host='0.0.0.0', port=5000, debug=False)
```

### 2. 防火墙设置
确保Windows防火墙允许5000端口的入站连接

### 3. 访问方式
局域网内其他用户可通过以下地址访问：
```
http://[服务器IP]:5000
```

### 4. 生产环境建议
- 使用Gunicorn或uWSGI作为WSGI服务器
- 配置Nginx作为反向代理
- 启用HTTPS
- 设置适当的访问控制

## 技术特点

### 1. 数据模型
- **Recipe**：配方主表（包含创建和更新时间）
- **RecipeItem**：配方项目表
- **BOMRequest**：BOM生成记录表

### 2. API接口
- `GET /api/recipes`：获取配方列表
- `GET /api/recipe/<id>`：获取配方详情
- `POST /api/recipe`：创建新配方
- `PUT /api/recipe/<id>`：更新配方
- `DELETE /api/recipe/<id>`：删除配方
- `GET /api/recipe/template`：下载导入模板
- `POST /api/recipe/import`：导入配方
- `GET /api/recipe/export/<id>`：导出配方
- `POST /api/generate_bom`：生成BOM表

### 3. 文件处理
- 使用openpyxl库处理Excel文件
- 支持样式设置（字体、对齐、边框等）
- 临时文件管理
- 文件上传和下载

## 扩展功能

### 1. 批量操作
- 支持Excel批量导入配方
- 支持配方批量导出
- 支持配方模板管理

### 2. 用户权限
- 管理员和普通用户角色
- 配方访问权限控制

### 3. 数据备份
- 数据库自动备份
- 配方版本管理
- 配方导入导出备份

### 4. 报表功能
- BOM使用统计
- 配方使用分析
- 配方项统计报表

## 故障排除

### 常见问题

1. **端口被占用**
   - 修改`app.py`中的端口号
   - 检查是否有其他服务占用5000端口

2. **依赖安装失败**
   - 升级pip：`python -m pip install --upgrade pip`
   - 使用国内镜像源：`pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ -r requirements.txt`

3. **数据库错误**
   - 删除`bom_system.db`文件重新运行
   - 检查SQLite是否正常工作

4. **Excel文件无法下载**
   - 检查临时文件权限
   - 确认openpyxl库安装正确

5. **配方导入失败**
   - 检查Excel文件格式是否正确
   - 确认必填字段已填写
   - 检查文件编码是否为UTF-8

## 联系支持

如有问题或建议，请联系系统管理员。

---

**版本**：1.0.0  
**更新日期**：2024年8月  
**开发语言**：Python 3.7+  
**框架**：Flask 2.3.3
