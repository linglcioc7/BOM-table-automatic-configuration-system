[33mtag v1.0[m
Tagger: BOMç³»ç»Ÿå¼€å‘è€… <developer@bom-system.com>
Date:   Sat Aug 16 13:51:54 2025 +0800

ç‰ˆæœ¬1.0: BOMç”Ÿæˆç³»ç»Ÿå®Œæ•´åŠŸèƒ½å®ç°

[33mcommit 620bb60543cca232a62d660d536cdc4a2fb56b77[m[33m ([m[1;36mHEAD[m[33m -> [m[1;32mmaster[m[33m, [m[1;33mtag: [m[1;33mv1.0[m[33m)[m
Author: BOMç³»ç»Ÿå¼€å‘è€… <developer@bom-system.com>
Date:   Sat Aug 16 13:51:42 2025 +0800

    ç‰ˆæœ¬1.0: BOMç”Ÿæˆç³»ç»Ÿå®Œæ•´åŠŸèƒ½å®ç°
    
    ä¸»è¦åŠŸèƒ½:
    - BOMè¡¨ç”Ÿæˆ(æ”¯æŒå¤šé…æ–¹é€‰æ‹©)
    - é…æ–¹ç®¡ç†(å¢åˆ æ”¹æŸ¥ã€å¯¼å…¥å¯¼å‡º)
    - æ‰¹é‡BOMç”Ÿæˆ(å¼¹çª—è¡¨æ ¼è¾“å…¥)
    - é…æ–¹æ‰¹é‡å¯¼å‡º(å•è¡¨æ•´åˆæ ¼å¼)
    - æœç´¢åˆ†é¡µåŠŸèƒ½
    - å“åº”å¼Webç•Œé¢
    
    æŠ€æœ¯ç‰¹ç‚¹:
    - Flask + SQLite + Bootstrap 5
    - æ”¯æŒExcelå¯¼å…¥å¯¼å‡º
    - å±€åŸŸç½‘éƒ¨ç½²æ”¯æŒ
    - å®Œæ•´çš„é”™è¯¯å¤„ç†

[1mdiff --git a/.gitignore b/.gitignore[m
[1mnew file mode 100644[m
[1mindex 0000000..c80d514[m
[1m--- /dev/null[m
[1m+++ b/.gitignore[m
[36m@@ -0,0 +1,65 @@[m
[32m+[m[32m# Python[m
[32m+[m[32m__pycache__/[m
[32m+[m[32m*.py[cod][m
[32m+[m[32m*$py.class[m
[32m+[m[32m*.so[m
[32m+[m[32m.Python[m
[32m+[m[32mbuild/[m
[32m+[m[32mdevelop-eggs/[m
[32m+[m[32mdist/[m
[32m+[m[32mdownloads/[m
[32m+[m[32meggs/[m
[32m+[m[32m.eggs/[m
[32m+[m[32mlib/[m
[32m+[m[32mlib64/[m
[32m+[m[32mparts/[m
[32m+[m[32msdist/[m
[32m+[m[32mvar/[m
[32m+[m[32mwheels/[m
[32m+[m[32m*.egg-info/[m
[32m+[m[32m.installed.cfg[m
[32m+[m[32m*.egg[m
[32m+[m[32mMANIFEST[m
[32m+[m
[32m+[m[32m# Flask[m
[32m+[m[32minstance/[m
[32m+[m[32m.webassets-cache[m
[32m+[m
[32m+[m[32m# Database[m
[32m+[m[32m*.db[m
[32m+[m[32m*.sqlite[m
[32m+[m[32m*.sqlite3[m
[32m+[m
[32m+[m[32m# Environment variables[m
[32m+[m[32m.env[m
[32m+[m[32m.venv[m
[32m+[m[32menv/[m
[32m+[m[32mvenv/[m
[32m+[m[32mENV/[m
[32m+[m[32menv.bak/[m
[32m+[m[32mvenv.bak/[m
[32m+[m
[32m+[m[32m# IDE[m
[32m+[m[32m.vscode/[m
[32m+[m[32m.idea/[m
[32m+[m[32m*.swp[m
[32m+[m[32m*.swo[m
[32m+[m[32m*~[m
[32m+[m
[32m+[m[32m# OS[m
[32m+[m[32m.DS_Store[m
[32m+[m[32m.DS_Store?[m
[32m+[m[32m._*[m
[32m+[m[32m.Spotlight-V100[m
[32m+[m[32m.Trashes[m
[32m+[m[32mehthumbs.db[m
[32m+[m[32mThumbs.db[m
[32m+[m
[32m+[m[32m# Temporary files[m
[32m+[m[32m*.tmp[m
[32m+[m[32m*.temp[m
[32m+[m[32m*.log[m
[32m+[m
[32m+[m[32m# Excel files (if you want to exclude them)[m
[32m+[m[32m# *.xlsx[m
[32m+[m[32m# *.xls[m
[1mdiff --git a/README.md b/README.md[m
[1mnew file mode 100644[m
[1mindex 0000000..129d487[m
[1m--- /dev/null[m
[1m+++ b/README.md[m
[36m@@ -0,0 +1,234 @@[m
[32m+[m[32m# BOMç”Ÿæˆç³»ç»Ÿ[m
[32m+[m
[32m+[m[32mä¸€ä¸ªåŸºäºPython Flaskçš„è‡ªåŠ¨BOMï¼ˆç‰©æ–™æ¸…å•ï¼‰è¡¨ç”Ÿæˆç³»ç»Ÿï¼Œæ”¯æŒå®Œæ•´çš„é…æ–¹ç®¡ç†å’ŒExcelå¯¼å…¥å¯¼å‡ºåŠŸèƒ½ã€‚[m
[32m+[m
[32m+[m[32m## ç³»ç»Ÿç‰¹ç‚¹[m
[32m+[m
[32m+[m[32m- ğŸš€ **è‡ªåŠ¨åŒ–ç”Ÿæˆ**ï¼šæ ¹æ®é…æ–¹è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†æ ¼å¼çš„BOMè¡¨[m
[32m+[m[32m- ğŸ“Š **é…æ–¹ç®¡ç†**ï¼šæ”¯æŒé…æ–¹çš„å¢åˆ æ”¹æŸ¥ã€å¯¼å…¥å¯¼å‡º[m
[32m+[m[32m- ğŸ“„ **Excelå¯¼å…¥å¯¼å‡º**ï¼šæ”¯æŒé…æ–¹æ¨¡æ¿ä¸‹è½½ã€æ‰¹é‡å¯¼å…¥ã€é…æ–¹å¯¼å‡º[m
[32m+[m[32m- ğŸŒ **Webç•Œé¢**ï¼šåŸºäºæµè§ˆå™¨çš„å‹å¥½ç”¨æˆ·ç•Œé¢[m
[32m+[m[32m- ğŸ”§ **æ˜“äºç»´æŠ¤**ï¼šé…æ–¹ä¿¡æ¯å¯éšæ—¶æ›´æ–°å’Œç®¡ç†[m
[32m+[m
[32m+[m[32m## ç³»ç»Ÿæ¶æ„[m
[32m+[m
[32m+[m[32m- **åç«¯**ï¼šPython Flask + SQLAlchemy + SQLite[m
[32m+[m[32m- **å‰ç«¯**ï¼šHTML + JavaScript + Bootstrap 5[m
[32m+[m[32m- **æ•°æ®åº“**ï¼šSQLiteï¼ˆè½»é‡çº§ï¼Œæ— éœ€é¢å¤–å®‰è£…ï¼‰[m
[32m+[m[32m- **æ–‡ä»¶æ ¼å¼**ï¼šExcel (.xlsx)[m
[32m+[m
[32m+[m[32m## å®‰è£…å’Œè¿è¡Œ[m
[32m+[m
[32m+[m[32m### 1. ç¯å¢ƒè¦æ±‚[m
[32m+[m[32m- Python 3.7+[m
[32m+[m[32m- pipåŒ…ç®¡ç†å™¨[m
[32m+[m
[32m+[m[32m### 2. å®‰è£…ä¾èµ–[m
[32m+[m[32m```bash[m
[32m+[m[32mpip install -r requirements.txt[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### 3. è¿è¡Œç³»ç»Ÿ[m
[32m+[m[32m```bash[m
[32m+[m[32mpython app.py[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### 4. è®¿é—®ç³»ç»Ÿ[m
[32m+[m[32m- ä¸»é¡µé¢ï¼šhttp://localhost:5000[m
[32m+[m[32m- ç®¡ç†é¡µé¢ï¼šhttp://localhost:5000/admin[m
[32m+[m
[32m+[m[32m## åŠŸèƒ½è¯´æ˜[m
[32m+[m
[32m+[m[32m### ä¸»è¦åŠŸèƒ½[m
[32m+[m
[32m+[m[32m#### 1. BOMè¡¨ç”Ÿæˆ[m
[32m+[m[32m- **çˆ¶é¡¹ç‰©æ–™å·**ï¼šè‡ªåˆ¶äº§æˆå“çš„ç‰©æ–™ç¼–ç [m
[32m+[m[32m- **ç‰©æ–™åç§°**ï¼šçˆ¶ä»¶ç‰©æ–™çš„æè¿°åç§°[m
[32m+[m[32m- **åŸºæœ¬æ•°é‡**ï¼šBOMäº§å“çš„åŸºæœ¬æ•°é‡[m
[32m+[m[32m- **åŸºæœ¬å•ä½**ï¼šBOMäº§å“çš„åŸºæœ¬å•ä½ï¼ˆPCSã€KGã€Mç­‰ï¼‰[m
[32m+[m[32m- **é…æ–¹é€‰æ‹©**ï¼šé€‰æ‹©å¯¹åº”çš„ç”Ÿäº§é…æ–¹[m
[32m+[m
[32m+[m[32m#### 2. é…æ–¹ç®¡ç†[m
[32m+[m[32m- **é…æ–¹æ·»åŠ **ï¼šé€šè¿‡Webç•Œé¢æ·»åŠ æ–°é…æ–¹[m
[32m+[m[32m- **é…æ–¹ç¼–è¾‘**ï¼šä¿®æ”¹ç°æœ‰é…æ–¹çš„åç§°ã€æè¿°å’Œé…æ–¹é¡¹[m
[32m+[m[32m- **é…æ–¹åˆ é™¤**ï¼šè½¯åˆ é™¤é…æ–¹ï¼ˆè®¾ç½®is_activeä¸ºFalseï¼‰[m
[32m+[m[32m- **é…æ–¹æŸ¥çœ‹**ï¼šæŸ¥çœ‹é…æ–¹çš„è¯¦ç»†ä¿¡æ¯å’Œé…æ–¹é¡¹åˆ—è¡¨[m
[32m+[m[32m- **é…æ–¹å¯¼å…¥**ï¼šä»Excelæ–‡ä»¶æ‰¹é‡å¯¼å…¥é…æ–¹æ•°æ®[m
[32m+[m[32m- **é…æ–¹å¯¼å‡º**ï¼šå°†é…æ–¹å¯¼å‡ºä¸ºExcelæ ¼å¼æ–‡ä»¶[m
[32m+[m[32m- **æ¨¡æ¿ä¸‹è½½**ï¼šä¸‹è½½æ ‡å‡†é…æ–¹å¯¼å…¥æ¨¡æ¿[m
[32m+[m
[32m+[m[32m#### 3. è¡Œå·ç¼–ç è§„åˆ™[m
[32m+[m[32m- è¡Œå·æ ¼å¼ï¼š0010ã€0020ã€0030...ï¼ˆ4ä½æ•°å­—æ–‡æœ¬æ ¼å¼ï¼‰[m
[32m+[m[32m- ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·å¯æ‰‹åŠ¨è°ƒæ•´[m
[32m+[m[32m- æ”¯æŒè‡ªå®šä¹‰è¡Œå·è¾“å…¥[m
[32m+[m
[32m+[m[32m### BOMè¡¨å­—æ®µè¯´æ˜[m
[32m+[m
[32m+[m[32mç”Ÿæˆçš„BOMè¡¨åŒ…å«ä»¥ä¸‹17åˆ—ï¼š[m
[32m+[m
[32m+[m[32m| åˆ— | å­—æ®µåç§° | è¯´æ˜ | é»˜è®¤å€¼ |[m
[32m+[m[32m|---|----------|------|--------|[m
[32m+[m[32m| A | å­—æ®µåç§° | å­—æ®µå¡«å†™è¯´æ˜ | ç©º |[m
[32m+[m[32m| B | å·¥å‚ | 4ä½å·¥å‚ä»£ç  | P060 |[m
[32m+[m[32m| C | BOMå¯é€‰æ–‡æœ¬ | ä¸åŒå¯é€‰BOMçš„æ–‡æœ¬æè¿° | é…æ–¹æè¿° |[m
[32m+[m[32m| D | çˆ¶é¡¹ç‰©æ–™å· | è‡ªåˆ¶äº§æˆå“ | ç”¨æˆ·è¾“å…¥ |[m
[32m+[m[32m| E | ç‰©æ–™åç§° | çˆ¶ä»¶ç‰©æ–™æè¿° | ç”¨æˆ·è¾“å…¥ |[m
[32m+[m[32m| F | ç”Ÿæ•ˆæ—¥æœŸ | BOMç”Ÿæ•ˆçš„å¼€å§‹æ—¥æœŸ | ç©º |[m
[32m+[m[32m| G | BOMç”¨é€” | ç”¨é€”æ ‡è¯† | 1 |[m
[32m+[m[32m| H | å¯é€‰BOM | BOMç¼–å·ï¼ˆ01ã€02ã€03...ï¼‰ | è‡ªåŠ¨ç”Ÿæˆ |[m
[32m+[m[32m| I | BOMçŠ¶æ€ | çŠ¶æ€æ ‡è¯† | 01 |[m
[32m+[m[32m| J | åŸºæœ¬æ•°é‡ | BOMäº§å“çš„åŸºæœ¬æ•°é‡ | ç”¨æˆ·è¾“å…¥ |[m
[32m+[m[32m| K | åŸºæœ¬å•ä½ | BOMäº§å“çš„åŸºæœ¬å•ä½ | ç”¨æˆ·è¾“å…¥ |[m
[32m+[m[32m| L | è¡Œé¡¹ç›®å· | å­ä»¶è¡Œé¡¹ç›®ç¼–å· | é…æ–¹å®šä¹‰ï¼ˆ0010ã€0020...ï¼‰ |[m
[32m+[m[32m| M | é¡¹ç›®ç±»åˆ« | å›ºå®šå€¼"L"ï¼Œè™šæ‹Ÿä»¶ä¸º"N" | L |[m
[32m+[m[32m| N | å­é¡¹ç‰©æ–™å· | ç»„ä»¶é¡¹çš„ç‰©æ–™ç¼–ç  | é…æ–¹å®šä¹‰ |[m
[32m+[m[32m| O | å­é¡¹ç‰©æ–™æè¿° | å­ä»¶ç‰©æ–™æè¿° | é…æ–¹å®šä¹‰ |[m
[32m+[m[32m| P | å­é¡¹æ•°é‡ | å­ä»¶ç‰©æ–™çš„ç”¨é‡ | é…æ–¹å®šä¹‰ |[m
[32m+[m[32m| Q | å­é¡¹å•ä½ | å­ä»¶ç‰©æ–™çš„è®¡é‡å•ä½ | é…æ–¹å®šä¹‰ |[m
[32m+[m
[32m+[m[32m## ä½¿ç”¨æµç¨‹[m
[32m+[m
[32m+[m[32m### 1. ç³»ç»Ÿåˆå§‹åŒ–[m
[32m+[m[32mé¦–æ¬¡è¿è¡Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºç¤ºä¾‹æ•°æ®ï¼š[m
[32m+[m[32m- ç¤ºä¾‹é…æ–¹ï¼šæ ‡å‡†é…æ–¹1ï¼ˆåŒ…å«2ä¸ªé…æ–¹é¡¹ï¼‰[m
[32m+[m
[32m+[m[32m### 2. é…æ–¹ç®¡ç†[m
[32m+[m[32m1. è®¿é—®ç®¡ç†é¡µé¢ï¼š`/admin`[m
[32m+[m[32m2. **æ·»åŠ é…æ–¹**ï¼šç‚¹å‡»"æ·»åŠ é…æ–¹"æŒ‰é’®ï¼Œå¡«å†™é…æ–¹ä¿¡æ¯[m
[32m+[m[32m3. **ç¼–è¾‘é…æ–¹**ï¼šç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ä¿®æ”¹ç°æœ‰é…æ–¹[m
[32m+[m[32m4. **åˆ é™¤é…æ–¹**ï¼šç‚¹å‡»"åˆ é™¤"æŒ‰é’®åˆ é™¤é…æ–¹[m
[32m+[m[32m5. **å¯¼å…¥é…æ–¹**ï¼šä¸‹è½½æ¨¡æ¿ï¼Œå¡«å†™æ•°æ®åä¸Šä¼ [m
[32m+[m[32m6. **å¯¼å‡ºé…æ–¹**ï¼šå°†é…æ–¹å¯¼å‡ºä¸ºExcelæ–‡ä»¶[m
[32m+[m
[32m+[m[32m### 3. ç”ŸæˆBOMè¡¨[m
[32m+[m[32m1. åœ¨ä¸»é¡µé¢å¡«å†™BOMä¿¡æ¯[m
[32m+[m[32m2. é€‰æ‹©å¯¹åº”çš„é…æ–¹[m
[32m+[m[32m3. ç‚¹å‡»"ç”ŸæˆBOMè¡¨"[m
[32m+[m[32m4. ç³»ç»Ÿè‡ªåŠ¨ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½[m
[32m+[m
[32m+[m[32m## é…æ–¹å¯¼å…¥å¯¼å‡º[m
[32m+[m
[32m+[m[32m### å¯¼å…¥æ¨¡æ¿æ ¼å¼[m
[32m+[m[32mExcelæ¨¡æ¿åŒ…å«ä»¥ä¸‹åˆ—ï¼š[m
[32m+[m[32m- **è¡Œå·**ï¼šé…æ–¹é¡¹çš„è¡Œå·ï¼ˆå¦‚0010ã€0020ï¼‰[m
[32m+[m[32m- **ç‰©æ–™ç¼–ç **ï¼šç‰©æ–™çš„ç¼–ç [m
[32m+[m[32m- **ç‰©æ–™åç§°**ï¼šç‰©æ–™çš„åç§°[m
[32m+[m[32m- **æ•°é‡**ï¼šç‰©æ–™çš„æ•°é‡[m
[32m+[m[32m- **å•ä½**ï¼šç‰©æ–™çš„å•ä½ï¼ˆPCSã€KGã€Mç­‰ï¼‰[m
[32m+[m[32m- **ç±»åˆ«**ï¼šé¡¹ç›®ç±»åˆ«ï¼ˆLæˆ–Nï¼‰[m
[32m+[m
[32m+[m[32m### å¯¼å…¥æ­¥éª¤[m
[32m+[m[32m1. ä¸‹è½½é…æ–¹å¯¼å…¥æ¨¡æ¿[m
[32m+[m[32m2. æŒ‰ç…§æ¨¡æ¿æ ¼å¼å¡«å†™æ•°æ®[m
[32m+[m[32m3. åœ¨ç®¡ç†é¡µé¢ç‚¹å‡»"å¯¼å…¥é…æ–¹"[m
[32m+[m[32m4. å¡«å†™é…æ–¹åç§°å’Œæè¿°[m
[32m+[m[32m5. é€‰æ‹©Excelæ–‡ä»¶å¹¶ä¸Šä¼ [m
[32m+[m
[32m+[m[32m### å¯¼å‡ºåŠŸèƒ½[m
[32m+[m[32m- æ”¯æŒå°†å•ä¸ªé…æ–¹å¯¼å‡ºä¸ºExcelæ–‡ä»¶[m
[32m+[m[32m- å¯¼å‡ºæ–‡ä»¶åŒ…å«é…æ–¹åŸºæœ¬ä¿¡æ¯å’Œé…æ–¹é¡¹åˆ—è¡¨[m
[32m+[m[32m- ä¾¿äºé…æ–¹æ•°æ®çš„å¤‡ä»½å’Œåˆ†äº«[m
[32m+[m
[32m+[m[32m## å±€åŸŸç½‘éƒ¨ç½²[m
[32m+[m
[32m+[m[32m### 1. ä¿®æ”¹è¿è¡Œé…ç½®[m
[32m+[m[32måœ¨`app.py`ä¸­ä¿®æ”¹è¿è¡Œå‚æ•°ï¼š[m
[32m+[m[32m```python[m
[32m+[m[32mapp.run(host='0.0.0.0', port=5000, debug=False)[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### 2. é˜²ç«å¢™è®¾ç½®[m
[32m+[m[32mç¡®ä¿Windowsé˜²ç«å¢™å…è®¸5000ç«¯å£çš„å…¥ç«™è¿æ¥[m
[32m+[m
[32m+[m[32m### 3. è®¿é—®æ–¹å¼[m
[32m+[m[32må±€åŸŸç½‘å†…å…¶ä»–ç”¨æˆ·å¯é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š[m
[32m+[m[32m```[m
[32m+[m[32mhttp://[æœåŠ¡å™¨IP]:5000[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### 4. ç”Ÿäº§ç¯å¢ƒå»ºè®®[m
[32m+[m[32m- ä½¿ç”¨Gunicornæˆ–uWSGIä½œä¸ºWSGIæœåŠ¡å™¨[m
[32m+[m[32m- é…ç½®Nginxä½œä¸ºåå‘ä»£ç†[m
[32m+[m[32m- å¯ç”¨HTTPS[m
[32m+[m[32m- è®¾ç½®é€‚å½“çš„è®¿é—®æ§åˆ¶[m
[32m+[m
[32m+[m[32m## æŠ€æœ¯ç‰¹ç‚¹[m
[32m+[m
[32m+[m[32m### 1. æ•°æ®æ¨¡å‹[m
[32m+[m[32m- **Recipe**ï¼šé…æ–¹ä¸»è¡¨ï¼ˆåŒ…å«åˆ›å»ºå’Œæ›´æ–°æ—¶é—´ï¼‰[m
[32m+[m[32m- **RecipeItem**ï¼šé…æ–¹é¡¹ç›®è¡¨[m
[32m+[m[32m- **BOMRequest**ï¼šBOMç”Ÿæˆè®°å½•è¡¨[m
[32m+[m
[32m+[m[32m### 2. APIæ¥å£[m
[32m+[m[32m- `GET /api/recipes`ï¼šè·å–é…æ–¹åˆ—è¡¨[m
[32m+[m[32m- `GET /api/recipe/<id>`ï¼šè·å–é…æ–¹è¯¦æƒ…[m
[32m+[m[32m- `POST /api/recipe`ï¼šåˆ›å»ºæ–°é…æ–¹[m
[32m+[m[32m- `PUT /api/recipe/<id>`ï¼šæ›´æ–°é…æ–¹[m
[32m+[m[32m- `DELETE /api/recipe/<id>`ï¼šåˆ é™¤é…æ–¹[m
[32m+[m[32m- `GET /api/recipe/template`ï¼šä¸‹è½½å¯¼å…¥æ¨¡æ¿[m
[32m+[m[32m- `POST /api/recipe/import`ï¼šå¯¼å…¥é…æ–¹[m
[32m+[m[32m- `GET /api/recipe/export/<id>`ï¼šå¯¼å‡ºé…æ–¹[m
[32m+[m[32m- `POST /api/generate_bom`ï¼šç”ŸæˆBOMè¡¨[m
[32m+[m
[32m+[m[32m### 3. æ–‡ä»¶å¤„ç†[m
[32m+[m[32m- ä½¿ç”¨openpyxlåº“å¤„ç†Excelæ–‡ä»¶[m
[32m+[m[32m- æ”¯æŒæ ·å¼è®¾ç½®ï¼ˆå­—ä½“ã€å¯¹é½ã€è¾¹æ¡†ç­‰ï¼‰[m
[32m+[m[32m- ä¸´æ—¶æ–‡ä»¶ç®¡ç†[m
[32m+[m[32m- æ–‡ä»¶ä¸Šä¼ å’Œä¸‹è½½[m
[32m+[m
[32m+[m[32m## æ‰©å±•åŠŸèƒ½[m
[32m+[m
[32m+[m[32m### 1. æ‰¹é‡æ“ä½œ[m
[32m+[m[32m- æ”¯æŒExcelæ‰¹é‡å¯¼å…¥é…æ–¹[m
[32m+[m[32m- æ”¯æŒé…æ–¹æ‰¹é‡å¯¼å‡º[m
[32m+[m[32m- æ”¯æŒé…æ–¹æ¨¡æ¿ç®¡ç†[m
[32m+[m
[32m+[m[32m### 2. ç”¨æˆ·æƒé™[m
[32m+[m[32m- ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·è§’è‰²[m
[32m+[m[32m- é…æ–¹è®¿é—®æƒé™æ§åˆ¶[m
[32m+[m
[32m+[m[32m### 3. æ•°æ®å¤‡ä»½[m
[32m+[m[32m- æ•°æ®åº“è‡ªåŠ¨å¤‡ä»½[m
[32m+[m[32m- é…æ–¹ç‰ˆæœ¬ç®¡ç†[m
[32m+[m[32m- é…æ–¹å¯¼å…¥å¯¼å‡ºå¤‡ä»½[m
[32m+[m
[32m+[m[32m### 4. æŠ¥è¡¨åŠŸèƒ½[m
[32m+[m[32m- BOMä½¿ç”¨ç»Ÿè®¡[m
[32m+[m[32m- é…æ–¹ä½¿ç”¨åˆ†æ[m
[32m+[m[32m- é…æ–¹é¡¹ç»Ÿè®¡æŠ¥è¡¨[m
[32m+[m
[32m+[m[32m## æ•…éšœæ’é™¤[m
[32m+[m
[32m+[m[32m### å¸¸è§é—®é¢˜[m
[32m+[m
[32m+[m[32m1. **ç«¯å£è¢«å ç”¨**[m
[32m+[m[32m   - ä¿®æ”¹`app.py`ä¸­çš„ç«¯å£å·[m
[32m+[m[32m   - æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æœåŠ¡å ç”¨5000ç«¯å£[m
[32m+[m
[32m+[m[32m2. **ä¾èµ–å®‰è£…å¤±è´¥**[m
[32m+[m[32m   - å‡çº§pipï¼š`python -m pip install --upgrade pip`[m
[32m+[m[32m   - ä½¿ç”¨å›½å†…é•œåƒæºï¼š`pip install -i https://pypi.tuna.tsinghua.edu.cn/simple/ -r requirements.txt`[m
[32m+[m
[32m+[m[32m3. **æ•°æ®åº“é”™è¯¯**[m
[32m+[m[32m   - åˆ é™¤`bom_system.db`æ–‡ä»¶é‡æ–°è¿è¡Œ[m
[32m+[m[32m   - æ£€æŸ¥SQLiteæ˜¯å¦æ­£å¸¸å·¥ä½œ[m
[32m+[m
[32m+[m[32m4. **Excelæ–‡ä»¶æ— æ³•ä¸‹è½½**[m
[32m+[m[32m   - æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶æƒé™[m
[32m+[m[32m   - ç¡®è®¤openpyxlåº“å®‰è£…æ­£ç¡®[m
[32m+[m
[32m+[m[32m5. **é…æ–¹å¯¼å…¥å¤±è´¥**[m
[32m+[m[32m   - æ£€æŸ¥Excelæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®[m
[32m+[m[32m   - ç¡®è®¤å¿…å¡«å­—æ®µå·²å¡«å†™[m
[32m+[m[32m   - æ£€æŸ¥æ–‡ä»¶ç¼–ç æ˜¯å¦ä¸ºUTF-8[m
[32m+[m
[32m+[m[32m## è”ç³»æ”¯æŒ[m
[32m+[m
[32m+[m[32må¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚[m
[32m+[m
[32m+[m[32m---[m
[32m+[m
[32m+[m[32m**ç‰ˆæœ¬**ï¼š1.0.0[m[41m  [m
[32m+[m[32m**æ›´æ–°æ—¥æœŸ**ï¼š2024å¹´8æœˆ[m[41m  [m
[32m+[m[32m**å¼€å‘è¯­è¨€**ï¼šPython 3.7+[m[41m  [m
[32m+[m[32m**æ¡†æ¶**ï¼šFlask 2.3.3[m
[1mdiff --git a/app.py b/app.py[m
[1mnew file mode 100644[m
[1mindex 0000000..16911fc[m
[1m--- /dev/null[m
[1m+++ b/app.py[m
[36m@@ -0,0 +1,658 @@[m
[32m+[m[32mfrom flask import Flask, render_template, request, jsonify, send_file[m
[32m+[m[32mfrom flask_sqlalchemy import SQLAlchemy[m
[32m+[m[32mfrom datetime import datetime[m
[32m+[m[32mimport openpyxl[m
[32m+[m[32mfrom openpyxl.styles import Font, Alignment, Border, Side[m
[32m+[m[32mimport os[m
[32m+[m[32mimport tempfile[m
[32m+[m[32mimport uuid[m
[32m+[m
[32m+[m[32mapp = Flask(__name__)[m
[32m+[m[32mapp.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///bom_system.db'[m
[32m+[m[32mapp.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False[m
[32m+[m[32mdb = SQLAlchemy(app)[m
[32m+[m
[32m+[m[32m# æ•°æ®æ¨¡å‹[m
[32m+[m[32mclass Recipe(db.Model):[m
[32m+[m[32m    id = db.Column(db.Integer, primary_key=True)[m
[32m+[m[32m    recipe_name = db.Column(db.String(100), nullable=False)[m
[32m+[m[32m    description = db.Column(db.Text)[m
[32m+[m[32m    is_active = db.Column(db.Boolean, default=True)[m
[32m+[m[32m    created_at = db.Column(db.DateTime, default=datetime.utcnow)[m
[32m+[m[32m    updated_at = db.Column(db.DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)[m
[32m+[m
[32m+[m[32mclass RecipeItem(db.Model):[m
[32m+[m[32m    id = db.Column(db.Integer, primary_key=True)[m
[32m+[m[32m    recipe_id = db.Column(db.Integer, db.ForeignKey('recipe.id'), nullable=False)[m
[32m+[m[32m    material_code = db.Column(db.String(50), nullable=False)[m
[32m+[m[32m    material_name = db.Column(db.String(200), nullable=False)[m
[32m+[m[32m    quantity = db.Column(db.Float, nullable=False)[m
[32m+[m[32m    unit = db.Column(db.String(20), nullable=False)[m
[32m+[m[32m    line_number = db.Column(db.String(10), nullable=False)  # æ”¹ä¸ºå­—ç¬¦ä¸²æ ¼å¼[m
[32m+[m[32m    project_category = db.Column(db.String(10), default='L')[m
[32m+[m
[32m+[m[32mclass BOMRequest(db.Model):[m
[32m+[m[32m    id = db.Column(db.Integer, primary_key=True)[m
[32m+[m[32m    parent_material_code = db.Column(db.String(50), nullable=False)[m
[32m+[m[32m    parent_material_name = db.Column(db.String(200), nullable=False)[m
[32m+[m[32m    basic_quantity = db.Column(db.Float, nullable=False)[m
[32m+[m[32m    basic_unit = db.Column(db.String(20), nullable=False)[m
[32m+[m[32m    recipe_id = db.Column(db.Integer, db.ForeignKey('recipe.id'), nullable=False)[m
[32m+[m[32m    created_at = db.Column(db.DateTime, default=datetime.utcnow)[m
[32m+[m
[32m+[m[32m@app.route('/')[m
[32m+[m[32mdef index():[m
[32m+[m[32m    return render_template('index.html')[m
[32m+[m
[32m+[m[32m@app.route('/api/recipes')[m
[32m+[m[32mdef get_recipes():[m
[32m+[m[32m    recipes = Recipe.query.filter_by(is_active=True).all()[m
[32m+[m[32m    return jsonify([{[m
[32m+[m[32m        'id': r.id,[m
[32m+[m[32m        'name': r.recipe_name,[m
[32m+[m[32m        'description': r.description,[m
[32m+[m[32m        'created_at': r.created_at.strftime('%Y-%m-%d %H:%M:%S') if r.created_at else '',[m
[32m+[m[32m        'updated_at': r.updated_at.strftime('%Y-%m-%d %H:%M:%S') if r.updated_at else ''[m
[32m+[m[32m    } for r in recipes])[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe/<int:recipe_id>')[m
[32m+[m[32mdef get_recipe_items(recipe_id):[m
[32m+[m[32m    items = RecipeItem.query.filter_by(recipe_id=recipe_id).order_by(RecipeItem.line_number).all()[m
[32m+[m[32m    return jsonify([{[m
[32m+[m[32m        'id': item.id,[m
[32m+[m[32m        'material_code': item.material_code,[m
[32m+[m[32m        'material_name': item.material_name,[m
[32m+[m[32m        'quantity': item.quantity,[m
[32m+[m[32m        'unit': item.unit,[m
[32m+[m[32m        'line_number': item.line_number,[m
[32m+[m[32m        'project_category': item.project_category[m
[32m+[m[32m    } for item in items])[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe/<int:recipe_id>', methods=['PUT'])[m
[32m+[m[32mdef update_recipe(recipe_id):[m
[32m+[m[32m    data = request.json[m
[32m+[m[32m    recipe = Recipe.query.get(recipe_id)[m
[32m+[m[32m    if not recipe:[m
[32m+[m[32m        return jsonify({'success': False, 'message': 'é…æ–¹ä¸å­˜åœ¨'}), 404[m
[32m+[m[41m    [m
[32m+[m[32m    recipe.recipe_name = data['name'][m
[32m+[m[32m    recipe.description = data['description'][m
[32m+[m[32m    recipe.updated_at = datetime.utcnow()[m
[32m+[m[41m    [m
[32m+[m[32m    # åˆ é™¤æ—§çš„é…æ–¹é¡¹[m
[32m+[m[32m    RecipeItem.query.filter_by(recipe_id=recipe_id).delete()[m
[32m+[m[41m    [m
[32m+[m[32m    # æ·»åŠ æ–°çš„é…æ–¹é¡¹[m
[32m+[m[32m    for item in data['items']:[m
[32m+[m[32m        recipe_item = RecipeItem([m
[32m+[m[32m            recipe_id=recipe.id,[m
[32m+[m[32m            material_code=item['material_code'],[m
[32m+[m[32m            material_name=item['material_name'],[m
[32m+[m[32m            quantity=item['quantity'],[m
[32m+[m[32m            unit=item['unit'],[m
[32m+[m[32m            line_number=item['line_number'],[m
[32m+[m[32m            project_category=item['project_category'][m
[32m+[m[32m        )[m
[32m+[m[32m        db.session.add(recipe_item)[m
[32m+[m[41m    [m
[32m+[m[32m    db.session.commit()[m
[32m+[m[32m    return jsonify({'success': True, 'message': 'é…æ–¹æ›´æ–°æˆåŠŸ'})[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe/<int:recipe_id>', methods=['DELETE'])[m
[32m+[m[32mdef delete_recipe(recipe_id):[m
[32m+[m[32m    recipe = Recipe.query.get(recipe_id)[m
[32m+[m[32m    if not recipe:[m
[32m+[m[32m        return jsonify({'success': False, 'message': 'é…æ–¹ä¸å­˜åœ¨'}), 404[m
[32m+[m[41m    [m
[32m+[m[32m    # è½¯åˆ é™¤ï¼šè®¾ç½®is_activeä¸ºFalse[m
[32m+[m[32m    recipe.is_active = False[m
[32m+[m[32m    db.session.commit()[m
[32m+[m[41m    [m
[32m+[m[32m    return jsonify({'success': True, 'message': 'é…æ–¹åˆ é™¤æˆåŠŸ'})[m
[32m+[m
[32m+[m[32m@app.route('/api/generate_bom', methods=['POST'])[m
[32m+[m[32mdef generate_bom():[m
[32m+[m[32m    data = request.json[m
[32m+[m[41m    [m
[32m+[m[32m    # åˆ›å»ºBOMè¯·æ±‚è®°å½•[m
[32m+[m[32m    bom_request = BOMRequest([m
[32m+[m[32m        parent_material_code=data['parent_material_code'],[m
[32m+[m[32m        parent_material_name=data['parent_material_name'],[m
[32m+[m[32m        basic_quantity=data['basic_quantity'],[m
[32m+[m[32m        basic_unit=data['basic_unit'],[m
[32m+[m[32m        recipe_id=data['recipe_id'][m
[32m+[m[32m    )[m
[32m+[m[32m    db.session.add(bom_request)[m
[32m+[m[32m    db.session.commit()[m
[32m+[m[41m    [m
[32m+[m[32m    # è·å–é…æ–¹ä¿¡æ¯[m
[32m+[m[32m    recipe = Recipe.query.get(data['recipe_id'])[m
[32m+[m[32m    items = RecipeItem.query.filter_by(recipe_id=data['recipe_id']).order_by(RecipeItem.line_number).all()[m
[32m+[m[41m    [m
[32m+[m[32m    # ç”ŸæˆExcelæ–‡ä»¶[m
[32m+[m[32m    wb = openpyxl.Workbook()[m
[32m+[m[32m    ws = wb.active[m
[32m+[m[32m    ws.title = "BOMè¡¨"[m
[32m+[m[41m    [m
[32m+[m[32m    # è®¾ç½®åˆ—å®½[m
[32m+[m[32m    column_widths = [15, 10, 20, 20, 30, 15, 10, 10, 10, 15, 15, 15, 20, 30, 15, 15][m
[32m+[m[32m    for i, width in enumerate(column_widths, 1):[m
[32m+[m[32m        ws.column_dimensions[openpyxl.utils.get_column_letter(i)].width = width[m
[32m+[m[41m    [m
[32m+[m[32m    # è¡¨å¤´[m
[32m+[m[32m    headers = ['å­—æ®µåç§°', 'å·¥å‚', 'BOMå¯é€‰æ–‡æœ¬', 'çˆ¶é¡¹ç‰©æ–™å·', 'ç‰©æ–™åç§°', 'ç”Ÿæ•ˆæ—¥æœŸ',[m[41m [m
[32m+[m[32m               'BOMç”¨é€”', 'å¯é€‰BOM', 'BOMçŠ¶æ€', 'åŸºæœ¬æ•°é‡', 'åŸºæœ¬å•ä½', 'è¡Œé¡¹ç›®å·',[m[41m [m
[32m+[m[32m               'é¡¹ç›®ç±»åˆ«', 'å­é¡¹ç‰©æ–™å·', 'å­é¡¹ç‰©æ–™æè¿°', 'å­é¡¹æ•°é‡', 'å­é¡¹å•ä½'][m
[32m+[m[41m    [m
[32m+[m[32m    for col, header in enumerate(headers, 1):[m
[32m+[m[32m        cell = ws.cell(row=1, column=col, value=header)[m
[32m+[m[32m        cell.font = Font(bold=True)[m
[32m+[m[32m        cell.alignment = Alignment(horizontal='center', vertical='center')[m
[32m+[m[41m    [m
[32m+[m[32m    # æ•°æ®è¡Œ[m
[32m+[m[32m    row = 2[m
[32m+[m[32m    for i, item in enumerate(items):[m
[32m+[m[32m        # çˆ¶é¡¹è¡Œï¼ˆåªåœ¨ç¬¬ä¸€ä¸ªå­é¡¹æ—¶æ˜¾ç¤ºï¼‰[m
[32m+[m[32m        if i == 0:[m
[32m+[m[32m            ws.cell(row=row, column=1, value='')  # å­—æ®µåç§°[m
[32m+[m[32m            ws.cell(row=row, column=2, value='P060')  # å·¥å‚[m
[32m+[m[32m            ws.cell(row=row, column=3, value=recipe.description)  # BOMå¯é€‰æ–‡æœ¬[m
[32m+[m[32m            ws.cell(row=row, column=4, value=data['parent_material_code'])  # çˆ¶é¡¹ç‰©æ–™å·[m
[32m+[m[32m            ws.cell(row=row, column=5, value=data['parent_material_name'])  # ç‰©æ–™åç§°[m
[32m+[m[32m            ws.cell(row=row, column=6, value='')  # ç”Ÿæ•ˆæ—¥æœŸ[m
[32m+[m[32m            ws.cell(row=row, column=7, value='1')  # BOMç”¨é€”[m
[32m+[m[32m            ws.cell(row=row, column=8, value=f"{i+1:02d}")  # å¯é€‰BOM[m
[32m+[m[32m            ws.cell(row=row, column=9, value='01')  # BOMçŠ¶æ€[m
[32m+[m[32m            ws.cell(row=row, column=10, value=data['basic_quantity'])  # åŸºæœ¬æ•°é‡[m
[32m+[m[32m            ws.cell(row=row, column=11, value=data['basic_unit'])  # åŸºæœ¬å•ä½[m
[32m+[m[32m            ws.cell(row=row, column=12, value='')  # è¡Œé¡¹ç›®å·[m
[32m+[m[32m            ws.cell(row=row, column=13, value='')  # é¡¹ç›®ç±»åˆ«[m
[32m+[m[32m            ws.cell(row=row, column=14, value='')  # å­é¡¹ç‰©æ–™å·[m
[32m+[m[32m            ws.cell(row=row, column=15, value='')  # å­é¡¹ç‰©æ–™æè¿°[m
[32m+[m[32m            ws.cell(row=row, column=16, value='')  # å­é¡¹æ•°é‡[m
[32m+[m[32m            ws.cell(row=row, column=17, value='')  # å­é¡¹å•ä½[m
[32m+[m[32m            row += 1[m
[32m+[m[41m        [m
[32m+[m[32m        # å­é¡¹è¡Œ[m
[32m+[m[32m        ws.cell(row=row, column=1, value='')  # å­—æ®µåç§°[m
[32m+[m[32m        ws.cell(row=row, column=2, value='P060')  # å·¥å‚[m
[32m+[m[32m        ws.cell(row=row, column=3, value='')  # BOMå¯é€‰æ–‡æœ¬[m
[32m+[m[32m        ws.cell(row=row, column=4, value='')  # çˆ¶é¡¹ç‰©æ–™å·[m
[32m+[m[32m        ws.cell(row=row, column=5, value='')  # ç‰©æ–™åç§°[m
[32m+[m[32m        ws.cell(row=row, column=6, value='')  # ç”Ÿæ•ˆæ—¥æœŸ[m
[32m+[m[32m        ws.cell(row=row, column=7, value='')  # BOMç”¨é€”[m
[32m+[m[32m        ws.cell(row=row, column=8, value='')  # å¯é€‰BOM[m
[32m+[m[32m        ws.cell(row=row, column=9, value='')  # BOMçŠ¶æ€[m
[32m+[m[32m        ws.cell(row=row, column=10, value='')  # åŸºæœ¬æ•°é‡[m
[32m+[m[32m        ws.cell(row=row, column=11, value='')  # åŸºæœ¬å•ä½[m
[32m+[m[32m        ws.cell(row=row, column=12, value=item.line_number)  # è¡Œé¡¹ç›®å·ï¼ˆç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²ï¼‰[m
[32m+[m[32m        ws.cell(row=row, column=13, value=item.project_category)  # é¡¹ç›®ç±»åˆ«[m
[32m+[m[32m        ws.cell(row=row, column=14, value=item.material_code)  # å­é¡¹ç‰©æ–™å·[m
[32m+[m[32m        ws.cell(row=row, column=15, value=item.material_name)  # å­é¡¹ç‰©æ–™æè¿°[m
[32m+[m[32m        ws.cell(row=row, column=16, value=item.quantity)  # å­é¡¹æ•°é‡[m
[32m+[m[32m        ws.cell(row=row, column=17, value=item.unit)  # å­é¡¹å•ä½[m
[32m+[m[32m        row += 1[m
[32m+[m[41m    [m
[32m+[m[32m    # ä¿å­˜æ–‡ä»¶[m
[32m+[m[32m    temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.xlsx')[m
[32m+[m[32m    wb.save(temp_file.name)[m
[32m+[m[32m    temp_file.close()[m
[32m+[m[41m    [m
[32m+[m[32m    return jsonify({[m
[32m+[m[32m        'success': True,[m
[32m+[m[32m        'message': 'BOMè¡¨ç”ŸæˆæˆåŠŸ',[m
[32m+[m[32m        'file_path': temp_file.name[m
[32m+[m[32m    })[m
[32m+[m
[32m+[m[32m@app.route('/api/download_bom/<path:file_path>')[m
[32m+[m[32mdef download_bom(file_path):[m
[32m+[m[32m    try:[m
[32m+[m[32m        return send_file(file_path, as_attachment=True, download_name='BOMè¡¨.xlsx')[m
[32m+[m[32m    except Exception as e:[m
[32m+[m[32m        return jsonify({'error': str(e)}), 400[m
[32m+[m
[32m+[m[32m@app.route('/admin')[m
[32m+[m[32mdef admin():[m
[32m+[m[32m    return render_template('admin.html')[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe', methods=['POST'])[m
[32m+[m[32mdef create_recipe():[m
[32m+[m[32m    data = request.json[m
[32m+[m[32m    recipe = Recipe([m
[32m+[m[32m        recipe_name=data['name'],[m
[32m+[m[32m        description=data['description'][m
[32m+[m[32m    )[m
[32m+[m[32m    db.session.add(recipe)[m
[32m+[m[32m    db.session.commit()[m
[32m+[m[41m    [m
[32m+[m[32m    # æ·»åŠ é…æ–¹é¡¹[m
[32m+[m[32m    for item in data['items']:[m
[32m+[m[32m        recipe_item = RecipeItem([m
[32m+[m[32m            recipe_id=recipe.id,[m
[32m+[m[32m            material_code=item['material_code'],[m
[32m+[m[32m            material_name=item['material_name'],[m
[32m+[m[32m            quantity=item['quantity'],[m
[32m+[m[32m            unit=item['unit'],[m
[32m+[m[32m            line_number=item['line_number'],[m
[32m+[m[32m            project_category=item['project_category'][m
[32m+[m[32m        )[m
[32m+[m[32m        db.session.add(recipe_item)[m
[32m+[m[41m    [m
[32m+[m[32m    db.session.commit()[m
[32m+[m[32m    return jsonify({'success': True, 'id': recipe.id})[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe/template')[m
[32m+[m[32mdef download_recipe_template():[m
[32m+[m[32m    """ä¸‹è½½é…æ–¹å¯¼å…¥æ¨¡æ¿"""[m
[32m+[m[32m    wb = openpyxl.Workbook()[m
[32m+[m[32m    ws = wb.active[m
[32m+[m[32m    ws.title = "é…æ–¹å¯¼å…¥æ¨¡æ¿"[m
[32m+[m[41m    [m
[32m+[m[32m    # è®¾ç½®åˆ—å®½[m
[32m+[m[32m    column_widths = [15, 20, 30, 15, 15, 15][m
[32m+[m[32m    for i, width in enumerate(column_widths, 1):[m
[32m+[m[32m        ws.column_dimensions[openpyxl.utils.get_column_letter(i)].width = width[m
[32m+[m[41m    [m
[32m+[m[32m    # è¡¨å¤´[m
[32m+[m[32m    headers = ['è¡Œå·', 'ç‰©æ–™ç¼–ç ', 'ç‰©æ–™åç§°', 'æ•°é‡', 'å•ä½', 'ç±»åˆ«'][m
[32m+[m[32m    for col, header in enumerate(headers, 1):[m
[32m+[m[32m        cell = ws.cell(row=1, column=col, value=header)[m
[32m+[m[32m        cell.font = Font(bold=True)[m
[32m+[m[32m        cell.alignment = Alignment(horizontal='center', vertical='center')[m
[32m+[m[41m    [m
[32m+[m[32m    # ç¤ºä¾‹æ•°æ®[m
[32m+[m[32m    example_data = [[m
[32m+[m[32m        ['0010', 'M001', 'åŸææ–™A', 2.5, 'KG', 'L'],[m
[32m+[m[32m        ['0020', 'M002', 'åŸææ–™B', 5, 'PCS', 'L'],[m
[32m+[m[32m        ['0030', 'M003', 'åŸææ–™C', 1.5, 'M', 'L'][m
[32m+[m[32m    ][m
[32m+[m[41m    [m
[32m+[m[32m    for row_idx, row_data in enumerate(example_data, 2):[m
[32m+[m[32m        for col_idx, value in enumerate(row_data, 1):[m
[32m+[m[32m            ws.cell(row=row_idx, column=col_idx, value=value)[m
[32m+[m[41m    [m
[32m+[m[32m    # ä¿å­˜æ–‡ä»¶[m
[32m+[m[32m    temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.xlsx')[m
[32m+[m[32m    wb.save(temp_file.name)[m
[32m+[m[32m    temp_file.close()[m
[32m+[m[41m    [m
[32m+[m[32m    return send_file(temp_file.name, as_attachment=True, download_name='é…æ–¹å¯¼å…¥æ¨¡æ¿.xlsx')[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe/import', methods=['POST'])[m
[32m+[m[32mdef import_recipe():[m
[32m+[m[32m    """å¯¼å…¥é…æ–¹"""[m
[32m+[m[32m    if 'file' not in request.files:[m
[32m+[m[32m        return jsonify({'success': False, 'message': 'æ²¡æœ‰é€‰æ‹©æ–‡ä»¶'}), 400[m
[32m+[m[41m    [m
[32m+[m[32m    file = request.files['file'][m
[32m+[m[32m    if file.filename == '':[m
[32m+[m[32m        return jsonify({'success': False, 'message': 'æ²¡æœ‰é€‰æ‹©æ–‡ä»¶'}), 400[m
[32m+[m[41m    [m
[32m+[m[32m    try:[m
[32m+[m[32m        # è¯»å–Excelæ–‡ä»¶[m
[32m+[m[32m        wb = openpyxl.load_workbook(file)[m
[32m+[m[32m        ws = wb.active[m
[32m+[m[41m        [m
[32m+[m[32m        # è·å–é…æ–¹åç§°å’Œæè¿°[m
[32m+[m[32m        recipe_name = request.form.get('recipe_name', 'å¯¼å…¥çš„é…æ–¹')[m
[32m+[m[32m        recipe_description = request.form.get('recipe_description', 'ä»Excelå¯¼å…¥çš„é…æ–¹')[m
[32m+[m[41m        [m
[32m+[m[32m        # åˆ›å»ºé…æ–¹[m
[32m+[m[32m        recipe = Recipe([m
[32m+[m[32m            recipe_name=recipe_name,[m
[32m+[m[32m            description=recipe_description[m
[32m+[m[32m        )[m
[32m+[m[32m        db.session.add(recipe)[m
[32m+[m[32m        db.session.commit()[m
[32m+[m[41m        [m
[32m+[m[32m        # è¯»å–é…æ–¹é¡¹[m
[32m+[m[32m        items = [][m
[32m+[m[32m        for row in range(2, ws.max_row + 1):  # ä»ç¬¬2è¡Œå¼€å§‹ï¼ˆè·³è¿‡è¡¨å¤´ï¼‰[m
[32m+[m[32m            line_number = ws.cell(row=row, column=1).value[m
[32m+[m[32m            material_code = ws.cell(row=row, column=2).value[m
[32m+[m[32m            material_name = ws.cell(row=row, column=3).value[m
[32m+[m[32m            quantity = ws.cell(row=row, column=4).value[m
[32m+[m[32m            unit = ws.cell(row=row, column=5).value[m
[32m+[m[32m            project_category = ws.cell(row=row, column=6).value or 'L'[m
[32m+[m[41m            [m
[32m+[m[32m            if all([line_number, material_code, material_name, quantity, unit]):[m
[32m+[m[32m                recipe_item = RecipeItem([m
[32m+[m[32m                    recipe_id=recipe.id,[m
[32m+[m[32m                    material_code=str(material_code),[m
[32m+[m[32m                    material_name=str(material_name),[m
[32m+[m[32m                    quantity=float(quantity),[m
[32m+[m[32m                    unit=str(unit),[m
[32m+[m[32m                    line_number=str(line_number),[m
[32m+[m[32m                    project_category=str(project_category)[m
[32m+[m[32m                )[m
[32m+[m[32m                db.session.add(recipe_item)[m
[32m+[m[32m                items.append(recipe_item)[m
[32m+[m[41m        [m
[32m+[m[32m        db.session.commit()[m
[32m+[m[41m        [m
[32m+[m[32m        return jsonify({[m
[32m+[m[32m            'success': True,[m[41m [m
[32m+[m[32m            'message': f'é…æ–¹å¯¼å…¥æˆåŠŸï¼Œå…±å¯¼å…¥ {len(items)} ä¸ªé…æ–¹é¡¹',[m
[32m+[m[32m            'recipe_id': recipe.id[m
[32m+[m[32m        })[m
[32m+[m[41m        [m
[32m+[m[32m    except Exception as e:[m
[32m+[m[32m        db.session.rollback()[m
[32m+[m[32m        return jsonify({'success': False, 'message': f'å¯¼å…¥å¤±è´¥ï¼š{str(e)}'}), 400[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe/export/<int:recipe_id>')[m
[32m+[m[32mdef export_recipe(recipe_id):[m
[32m+[m[32m    """å¯¼å‡ºé…æ–¹åˆ°Excel"""[m
[32m+[m[32m    recipe = Recipe.query.get(recipe_id)[m
[32m+[m[32m    if not recipe:[m
[32m+[m[32m        return jsonify({'success': False, 'message': 'é…æ–¹ä¸å­˜åœ¨'}), 404[m
[32m+[m[41m    [m
[32m+[m[32m    items = RecipeItem.query.filter_by(recipe_id=recipe_id).order_by(RecipeItem.line_number).all()[m
[32m+[m[41m    [m
[32m+[m[32m    # åˆ›å»ºExcelæ–‡ä»¶[m
[32m+[m[32m    wb = openpyxl.Workbook()[m
[32m+[m[32m    ws = wb.active[m
[32m+[m[32m    # è¿‡æ»¤sheetåç§°ä¸­çš„æ— æ•ˆå­—ç¬¦[m
[32m+[m[32m    safe_title = "".join(c for c in recipe.recipe_name if c not in r'\/:*?"<>|')[m
[32m+[m[32m    ws.title = safe_title[:31] if len(safe_title) > 31 else safe_title  # Excel sheetåç§°æœ€å¤§31å­—ç¬¦[m
[32m+[m[41m    [m
[32m+[m[32m    # è®¾ç½®åˆ—å®½[m
[32m+[m[32m    column_widths = [15, 20, 30, 15, 15, 15][m
[32m+[m[32m    for i, width in enumerate(column_widths, 1):[m
[32m+[m[32m        ws.column_dimensions[openpyxl.utils.get_column_letter(i)].width = width[m
[32m+[m[41m    [m
[32m+[m[32m    # é…æ–¹ä¿¡æ¯[m
[32m+[m[32m    ws.cell(row=1, column=1, value='é…æ–¹åç§°ï¼š')[m
[32m+[m[32m    ws.cell(row=1, column=2, value=recipe.recipe_name)[m
[32m+[m[32m    ws.cell(row=2, column=1, value='é…æ–¹æè¿°ï¼š')[m
[32m+[m[32m    ws.cell(row=2, column=2, value=recipe.description or '')[m
[32m+[m[41m    [m
[32m+[m[32m    # è¡¨å¤´[m
[32m+[m[32m    headers = ['è¡Œå·', 'ç‰©æ–™ç¼–ç ', 'ç‰©æ–™åç§°', 'æ•°é‡', 'å•ä½', 'ç±»åˆ«'][m
[32m+[m[32m    for col, header in enumerate(headers, 1):[m
[32m+[m[32m        cell = ws.cell(row=4, column=col, value=header)[m
[32m+[m[32m        cell.font = Font(bold=True)[m
[32m+[m[32m        cell.alignment = Alignment(horizontal='center', vertical='center')[m
[32m+[m[41m    [m
[32m+[m[32m    # é…æ–¹é¡¹æ•°æ®[m
[32m+[m[32m    for row_idx, item in enumerate(items, 5):[m
[32m+[m[32m        ws.cell(row=row_idx, column=1, value=item.line_number)[m
[32m+[m[32m        ws.cell(row=row_idx, column=2, value=item.material_code)[m
[32m+[m[32m        ws.cell(row=row_idx, column=3, value=item.material_name)[m
[32m+[m[32m        ws.cell(row=row_idx, column=4, value=item.quantity)[m
[32m+[m[32m        ws.cell(row=row_idx, column=5, value=item.unit)[m
[32m+[m[32m        ws.cell(row=row_idx, column=6, value=item.project_category)[m
[32m+[m[41m    [m
[32m+[m[32m    # ä¿å­˜æ–‡ä»¶[m
[32m+[m[32m    temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.xlsx')[m
[32m+[m[32m    wb.save(temp_file.name)[m
[32m+[m[32m    temp_file.close()[m
[32m+[m[41m    [m
[32m+[m[32m    return send_file(temp_file.name, as_attachment=True, download_name=f'{recipe.recipe_name}.xlsx')[m
[32m+[m
[32m+[m[32m@app.route('/api/recipe/export_all')[m
[32m+[m[32mdef export_all_recipes():[m
[32m+[m[32m    """æ‰¹é‡å¯¼å‡ºæ‰€æœ‰é…æ–¹åˆ°å•ä¸ªè¡¨æ ¼"""[m
[32m+[m[32m    try:[m
[32m+[m[32m        # è·å–æ‰€æœ‰æ´»è·ƒçš„é…æ–¹[m
[32m+[m[32m        recipes = Recipe.query.filter_by(is_active=True).order_by(Recipe.recipe_name).all()[m
[32m+[m[41m        [m
[32m+[m[32m        if not recipes:[m
[32m+[m[32m            return jsonify({'error': 'æ²¡æœ‰æ‰¾åˆ°å¯å¯¼å‡ºçš„é…æ–¹'}), 404[m
[32m+[m[41m        [m
[32m+[m[32m        # åˆ›å»ºå·¥ä½œç°¿[m
[32m+[m[32m        wb = openpyxl.Workbook()[m
[32m+[m[32m        ws = wb.active[m
[32m+[m[32m        ws.title = "æ‰€æœ‰é…æ–¹"[m
[32m+[m[41m        [m
[32m+[m[32m        # è®¾ç½®åˆ—å®½[m
[32m+[m[32m        column_widths = [20, 40, 15, 20, 30, 15, 15, 20][m
[32m+[m[32m        for i, width in enumerate(column_widths, 1):[m
[32m+[m[32m            ws.column_dimensions[openpyxl.utils.get_column_letter(i)].width = width[m
[32m+[m[41m        [m
[32m+[m[32m        # è¡¨å¤´ A-Håˆ—ï¼šé…æ–¹åç§°ã€é…æ–¹æè¿°ã€è¡Œå·ã€ç‰©æ–™ç¼–ç ã€ç‰©æ–™åç§°ã€æ•°é‡ã€å•ä½ã€ç±»åˆ«[m
[32m+[m[32m        headers = ['é…æ–¹åç§°', 'é…æ–¹æè¿°', 'è¡Œå·', 'ç‰©æ–™ç¼–ç ', 'ç‰©æ–™åç§°', 'æ•°é‡', 'å•ä½', 'ç±»åˆ«'][m
[32m+[m[32m        for col, header in enumerate(headers, 1):[m
[32m+[m[32m            cell = ws.cell(row=1, column=col, value=header)[m
[32m+[m[32m            cell.font = Font(bold=True)[m
[32m+[m[32m            cell.alignment = Alignment(horizontal='center', vertical='center')[m
[32m+[m[41m        [m
[32m+[m[32m        # æ•°æ®è¡Œ[m
[32m+[m[32m        row = 2[m
[32m+[m[32m        for recipe in recipes:[m
[32m+[m[32m            # è·å–é…æ–¹é¡¹[m
[32m+[m[32m            items = RecipeItem.query.filter_by(recipe_id=recipe.id).order_by(RecipeItem.line_number).all()[m
[32m+[m[41m            [m
[32m+[m[32m            # ä¸ºæ¯ä¸ªé…æ–¹é¡¹åˆ›å»ºä¸€è¡Œæ•°æ®[m
[32m+[m[32m            for item in items:[m
[32m+[m[32m                ws.cell(row=row, column=1, value=recipe.recipe_name)  # Aåˆ—ï¼šé…æ–¹åç§°[m
[32m+[m[32m                ws.cell(row=row, column=2, value=recipe.description or '')  # Båˆ—ï¼šé…æ–¹æè¿°[m
[32m+[m[32m                ws.cell(row=row, column=3, value=item.line_number)  # Cåˆ—ï¼šè¡Œå·[m
[32m+[m[32m                ws.cell(row=row, column=4, value=item.material_code)  # Dåˆ—ï¼šç‰©æ–™ç¼–ç [m
[32m+[m[32m                ws.cell(row=row, column=5, value=item.material_name)  # Eåˆ—ï¼šç‰©æ–™åç§°[m
[32m+[m[32m                ws.cell(row=row, column=6, value=item.quantity)  # Fåˆ—ï¼šæ•°é‡[m
[32m+[m[32m                ws.cell(row=row, column=7, value=item.unit)  # Gåˆ—ï¼šå•ä½[m
[32m+[m[32m                ws.cell(row=row, column=8, value=item.project_category)  # Håˆ—ï¼šç±»åˆ«[m
[32m+[m[32m                row += 1[m
[32m+[m[41m        [m
[32m+[m[32m        # ä¿å­˜æ–‡ä»¶[m
[32m+[m[32m        temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.xlsx')[m
[32m+[m[32m        wb.save(temp_file.name)[m
[32m+[m[32m        temp_file.close()[m
[32m+[m[41m        [m
[32m+[m[32m        return send_file(temp_file.name, as_attachment=True, download_name='æ‰€æœ‰é…æ–¹.xlsx')[m
[32m+[m[41m        [m
[32m+[m[32m    except Exception as e:[m
[32m+[m[32m        return jsonify({'error': str(e)}), 400[m
[32m+[m
[32m+[m
[32m+[m
[32m+[m
[32m+[m
[32m+[m[32m@app.route('/api/download_batch_bom/<path:file_path>')[m
[32m+[m[32mdef download_batch_bom(file_path):[m
[32m+[m[32m    """ä¸‹è½½æ‰¹é‡ç”Ÿæˆçš„BOMæ–‡ä»¶"""[m
[32m+[m[32m    try:[m
[32m+[m[32m        # ä¿®å¤æ–‡ä»¶è·¯å¾„é—®é¢˜[m
[32m+[m[32m        if file_path.startswith('C:'):[m
[32m+[m[32m            # å¤„ç†Windowsè·¯å¾„[m
[32m+[m[32m            file_path = file_path.replace('C:', 'C:\\')[m
[32m+[m[32m        elif file_path.startswith('C%3A'):[m
[32m+[m[32m            # å¤„ç†URLç¼–ç çš„è·¯å¾„[m
[32m+[m[32m            file_path = file_path.replace('C%3A', 'C:\\')[m
[32m+[m[41m        [m
[32m+[m[32m        # ç¡®ä¿æ–‡ä»¶å­˜åœ¨[m
[32m+[m[32m        if not os.path.exists(file_path):[m
[32m+[m[32m            return jsonify({'error': 'æ–‡ä»¶ä¸å­˜åœ¨'}), 404[m
[32m+[m[41m            [m
[32m+[m[32m        return send_file(file_path, as_attachment=True, download_name='æ‰¹é‡BOMè¡¨.xlsx')[m
[32m+[m[32m    except Exception as e:[m
[32m+[m[32m        return jsonify({'error': str(e)}), 400[m
[32m+[m
[32m+[m[32m@app.route('/api/bom/batch_generate_table', methods=['POST'])[m
[32m+[m[32mdef batch_generate_bom_from_table():[m
[32m+[m[32m    """ä»å¼¹çª—è¡¨æ ¼æ•°æ®æ‰¹é‡ç”ŸæˆBOM"""[m
[32m+[m[32m    try:[m
[32m+[m[32m        data = request.json[m
[32m+[m[32m        bom_data = data.get('bom_data', [])[m
[32m+[m[41m        [m
[32m+[m[32m        if not bom_data:[m
[32m+[m[32m            return jsonify({'success': False, 'message': 'æ²¡æœ‰æä¾›BOMæ•°æ®'}), 400[m
[32m+[m[41m        [m
[32m+[m[32m        bom_items = [][m
[32m+[m[32m        errors = [][m
[32m+[m[41m        [m
[32m+[m[32m        for item in bom_data:[m
[32m+[m[32m            # æ£€æŸ¥å¿…å¡«å­—æ®µ[m
[32m+[m[32m            if not all([item.get('parent_material_code'), item.get('parent_material_name'),[m[41m [m
[32m+[m[32m                       item.get('basic_quantity'), item.get('basic_unit'), item.get('recipe_names')]):[m
[32m+[m[32m                errors.append(f"ç¬¬{item.get('line_number', '?')}è¡Œï¼šå¿…å¡«å­—æ®µä¸å®Œæ•´")[m
[32m+[m[32m                continue[m
[32m+[m[41m            [m
[32m+[m[32m            # éªŒè¯æ•°é‡[m
[32m+[m[32m            try:[m
[32m+[m[32m                basic_quantity = float(item['basic_quantity'])[m
[32m+[m[32m                if basic_quantity <= 0:[m
[32m+[m[32m                    errors.append(f"ç¬¬{item.get('line_number', '?')}è¡Œï¼šåŸºæœ¬æ•°é‡å¿…é¡»å¤§äº0")[m
[32m+[m[32m                    continue[m
[32m+[m[32m            except:[m
[32m+[m[32m                errors.append(f"ç¬¬{item.get('line_number', '?')}è¡Œï¼šåŸºæœ¬æ•°é‡å¿…é¡»æ˜¯æ•°å­—")[m
[32m+[m[32m                continue[m
[32m+[m[41m            [m
[32m+[m[32m            # æŸ¥æ‰¾é…æ–¹ID[m
[32m+[m[32m            recipe_ids = [][m
[32m+[m[32m            for recipe_name in item['recipe_names']:[m
[32m+[m[32m                recipe = Recipe.query.filter_by(recipe_name=recipe_name, is_active=True).first()[m
[32m+[m[32m                if recipe:[m
[32m+[m[32m                    recipe_ids.append(recipe.id)[m
[32m+[m[32m                else:[m
[32m+[m[32m                    errors.append(f"ç¬¬{item.get('line_number', '?')}è¡Œï¼šé…æ–¹'{recipe_name}'ä¸å­˜åœ¨")[m
[32m+[m[32m                    break[m
[32m+[m[41m            [m
[32m+[m[32m            if len(recipe_ids) != len(item['recipe_names']):[m
[32m+[m[32m                continue[m
[32m+[m[41m            [m
[32m+[m[32m            # æ·»åŠ åˆ°BOMé¡¹ç›®åˆ—è¡¨[m
[32m+[m[32m            bom_items.append({[m
[32m+[m[32m                'parent_material_code': str(item['parent_material_code']),[m
[32m+[m[32m                'parent_material_name': str(item['parent_material_name']),[m
[32m+[m[32m                'basic_quantity': basic_quantity,[m
[32m+[m[32m                'basic_unit': str(item['basic_unit']),[m
[32m+[m[32m                'recipe_ids': recipe_ids,[m
[32m+[m[32m                'remark': item.get('notes', '')[m
[32m+[m[32m            })[m
[32m+[m[41m        [m
[32m+[m[32m        if errors:[m
[32m+[m[32m            return jsonify({[m
[32m+[m[32m                'success': False,[m[41m [m
[32m+[m[32m                'message': f'ç”Ÿæˆå¤±è´¥ï¼Œå‘ç° {len(errors)} ä¸ªé”™è¯¯',[m
[32m+[m[32m                'errors': errors[m
[32m+[m[32m            }), 400[m
[32m+[m[41m        [m
[32m+[m[32m        if not bom_items:[m
[32m+[m[32m            return jsonify({'success': False, 'message': 'æœªæ‰¾åˆ°æœ‰æ•ˆçš„BOMæ•°æ®'}), 400[m
[32m+[m[41m        [m
[32m+[m[32m        # ç”Ÿæˆæ‰€æœ‰BOMçš„Excelæ–‡ä»¶[m
[32m+[m[32m        wb_result = openpyxl.Workbook()[m
[32m+[m[32m        ws_result = wb_result.active[m
[32m+[m[32m        ws_result.title = "æ‰¹é‡BOMè¡¨"[m
[32m+[m[41m        [m
[32m+[m[32m        # ç¡®ä¿åªæœ‰ä¸€ä¸ªå·¥ä½œè¡¨[m
[32m+[m[32m        while len(wb_result.sheetnames) > 1:[m
[32m+[m[32m            wb_result.remove(wb_result.sheetnames[-1])[m
[32m+[m[41m        [m
[32m+[m[32m        print(f"DEBUG: åˆ›å»ºå·¥ä½œç°¿ï¼Œå·¥ä½œè¡¨æ•°é‡: {len(wb_result.sheetnames)}")[m
[32m+[m[32m        print(f"DEBUG: å·¥ä½œè¡¨åç§°: {wb_result.sheetnames}")[m
[32m+[m[41m        [m
[32m+[m[32m        # è®¾ç½®åˆ—å®½ (A-Qåˆ—)[m
[32m+[m[32m        column_widths = [15, 10, 20, 20, 30, 15, 10, 10, 10, 15, 15, 15, 20, 30, 15, 15, 15][m
[32m+[m[32m        for i, width in enumerate(column_widths, 1):[m
[32m+[m[32m            ws_result.column_dimensions[openpyxl.utils.get_column_letter(i)].width = width[m
[32m+[m[41m        [m
[32m+[m[32m        # è¡¨å¤´ (A-Qåˆ—)[m
[32m+[m[32m        headers = ['å­—æ®µåç§°', 'å·¥å‚', 'BOMå¯é€‰æ–‡æœ¬', 'çˆ¶é¡¹ç‰©æ–™å·', 'ç‰©æ–™åç§°', 'ç”Ÿæ•ˆæ—¥æœŸ',[m[41m [m
[32m+[m[32m                   'BOMç”¨é€”', 'å¯é€‰BOM', 'BOMçŠ¶æ€', 'åŸºæœ¬æ•°é‡', 'åŸºæœ¬å•ä½', 'è¡Œé¡¹ç›®å·',[m[41m [m
[32m+[m[32m                   'é¡¹ç›®ç±»åˆ«', 'å­é¡¹ç‰©æ–™å·', 'å­é¡¹ç‰©æ–™æè¿°', 'å­é¡¹æ•°é‡', 'å­é¡¹å•ä½'][m
[32m+[m[41m        [m
[32m+[m[32m        for col, header in enumerate(headers, 1):[m
[32m+[m[32m            cell = ws_result.cell(row=1, column=col, value=header)[m
[32m+[m[32m            cell.font = Font(bold=True)[m
[32m+[m[32m            cell.alignment = Alignment(horizontal='center', vertical='center')[m
[32m+[m[41m        [m
[32m+[m[32m        # æ•°æ®è¡Œ[m
[32m+[m[32m        row = 2[m
[32m+[m[41m        [m
[32m+[m[32m        for bom_item in bom_items:[m
[32m+[m[32m            # ä¸ºæ¯ä¸ªçˆ¶ç‰©æ–™é‡æ–°å¼€å§‹è®¡æ•°[m
[32m+[m[32m            bom_counter = 0[m
[32m+[m[41m            [m
[32m+[m[32m            # è·å–æ‰€æœ‰é€‰ä¸­çš„é…æ–¹ä¿¡æ¯[m
[32m+[m[32m            all_items = [][m
[32m+[m[41m            [m
[32m+[m[32m            for recipe_id in bom_item['recipe_ids']:[m
[32m+[m[32m                recipe = Recipe.query.get(recipe_id)[m
[32m+[m[32m                if recipe:[m
[32m+[m[32m                    items = RecipeItem.query.filter_by(recipe_id=recipe_id).order_by(RecipeItem.line_number).all()[m
[32m+[m[32m                    # ä¸ºæ¯ä¸ªé…æ–¹é¡¹æ·»åŠ é…æ–¹ä¿¡æ¯[m
[32m+[m[32m                    for item in items:[m
[32m+[m[32m                        all_items.append({[m
[32m+[m[32m                            'recipe_name': recipe.recipe_name,[m
[32m+[m[32m                            'recipe_description': recipe.description,[m
[32m+[m[32m                            'line_number': item.line_number,[m
[32m+[m[32m                            'material_code': item.material_code,[m
[32m+[m[32m                            'material_name': item.material_name,[m
[32m+[m[32m                            'quantity': item.quantity,[m
[32m+[m[32m                            'unit': item.unit,[m
[32m+[m[32m                            'project_category': item.project_category[m
[32m+[m[32m                        })[m
[32m+[m[41m            [m
[32m+[m[32m            # æŒ‰é…æ–¹åç§°æ’åº[m
[32m+[m[32m            all_items.sort(key=lambda x: x['recipe_name'])[m
[32m+[m[41m            [m
[32m+[m[32m            # ä¸ºæ¯ä¸ªBOMé¡¹ç”Ÿæˆæ•°æ®è¡Œ[m
[32m+[m[32m            current_recipe = None[m
[32m+[m[41m            [m
[32m+[m[32m            for item in all_items:[m
[32m+[m[32m                # å¦‚æœæ˜¯æ–°é…æ–¹ï¼Œæ›´æ–°è®¡æ•°å™¨[m
[32m+[m[32m                if current_recipe != item['recipe_name']:[m
[32m+[m[32m                    current_recipe = item['recipe_name'][m
[32m+[m[32m                    bom_counter += 1[m
[32m+[m[41m                [m
[32m+[m[32m                # æ¯è¡Œéƒ½å¡«å†™å®Œæ•´çš„æ•°æ®[m
[32m+[m[32m                ws_result.cell(row=row, column=1, value='')  # å­—æ®µåç§°[m
[32m+[m[32m                ws_result.cell(row=row, column=2, value='P060')  # å·¥å‚[m
[32m+[m[32m                ws_result.cell(row=row, column=3, value=item['recipe_description'])  # BOMå¯é€‰æ–‡æœ¬[m
[32m+[m[32m                ws_result.cell(row=row, column=4, value=bom_item['parent_material_code'])  # çˆ¶é¡¹ç‰©æ–™å·[m
[32m+[m[32m                ws_result.cell(row=row, column=5, value=bom_item['parent_material_name'])  # ç‰©æ–™åç§°[m
[32m+[m[32m                ws_result.cell(row=row, column=6, value='')  # ç”Ÿæ•ˆæ—¥æœŸ[m
[32m+[m[32m                ws_result.cell(row=row, column=7, value='1')  # BOMç”¨é€”[m
[32m+[m[32m                ws_result.cell(row=row, column=8, value=f"{bom_counter:02d}")  # å¯é€‰BOM[m
[32m+[m[32m                ws_result.cell(row=row, column=9, value='01')  # BOMçŠ¶æ€[m
[32m+[m[32m                ws_result.cell(row=row, column=10, value=bom_item['basic_quantity'])  # åŸºæœ¬æ•°é‡[m
[32m+[m[32m                ws_result.cell(row=row, column=11, value=bom_item['basic_unit'])  # åŸºæœ¬å•ä½[m
[32m+[m[32m                ws_result.cell(row=row, column=12, value=item['line_number'])  # è¡Œé¡¹ç›®å·[m
[32m+[m[32m                ws_result.cell(row=row, column=13, value=item['project_category'])  # é¡¹ç›®ç±»åˆ«[m
[32m+[m[32m                ws_result.cell(row=row, column=14, value=item['material_code'])  # å­é¡¹ç‰©æ–™å·[m
[32m+[m[32m                ws_result.cell(row=row, column=15, value=item['material_name'])  # å­é¡¹ç‰©æ–™æè¿°[m
[32m+[m[32m                ws_result.cell(row=row, column=16, value=item['quantity'])  # å­é¡¹æ•°é‡[m
[32m+[m[32m                ws_result.cell(row=row, column=17, value=item['unit'])  # å­é¡¹å•ä½[m
[32m+[m[41m                [m
[32m+[m[32m                row += 1[m
[32m+[m[41m        [m
[32m+[m[32m        # ä¿å­˜æ–‡ä»¶[m
[32m+[m[32m        temp_file = tempfile.NamedTemporaryFile(delete=False, suffix='.xlsx')[m
[32m+[m[32m        wb_result.save(temp_file.name)[m
[32m+[m[32m        temp_file.close()[m
[32m+[m[41m        [m
[32m+[m[32m        return jsonify({[m
[32m+[m[32m            'success': True,[m
[32m+[m[32m            'message': f'æˆåŠŸç”Ÿæˆ {len(bom_items)} ä¸ªBOMè¡¨ï¼',[m
[32m+[m[32m            'file_path': temp_file.name,[m
[32m+[m[32m            'bom_count': len(bom_items)[m
[32m+[m[32m        })[m
[32m+[m[41m        [m
[32m+[m[32m    except Exception as e:[m
[32m+[m[32m        return jsonify({'success': False, 'message': f'æ‰¹é‡ç”Ÿæˆå¤±è´¥ï¼š{str(e)}'}), 400[m
[32m+[m
[32m+[m[32mif __name__ == '__main__':[m
[32m+[m[32m    with app.app_context():[m
[32m+[m[32m        db.create_all()[m
[32m+[m[41m        [m
[32m+[m[32m        # åˆå§‹åŒ–ä¸€äº›ç¤ºä¾‹æ•°æ®[m
[32m+[m[32m        if not Recipe.query.first():[m
[32m+[m[32m            recipe = Recipe(recipe_name='æ ‡å‡†é…æ–¹1', description='æ ‡å‡†äº§å“é…æ–¹')[m
[32m+[m[32m            db.session.add(recipe)[m
[32m+[m[32m            db.session.commit()[m
[32m+[m[41m            [m
[32m+[m[32m            items = [[m
[32m+[m[32m                RecipeItem(recipe_id=recipe.id, material_code='M001', material_name='åŸææ–™A',[m[41m [m
[32m+[m[32m                          quantity=2.5, unit='KG', line_number='0010', project_category='L'),[m
[32m+[m[32m                RecipeItem(recipe_id=recipe.id, material_code='M002', material_name='åŸææ–™B',[m[41m [m
[32m+[m[32m                          quantity=5, unit='PCS', line_number='0020', project_category='L'),[m
[32m+[m[32m            ][m
[32m+[m[32m            for item in items:[m
[32m+[m[32m                db.session.add(item)[m
[32m+[m[41m            [m
[32m+[m[32m            db.session.commit()[m
[32m+[m[41m    [m
[32m+[m[32m    app.run(host='0.0.0.0', port=5000, debug=True)[m
[1mdiff --git a/config.py b/config.py[m
[1mnew file mode 100644[m
[1mindex 0000000..70e1f8a[m
[1m--- /dev/null[m
[1m+++ b/config.py[m
[36m@@ -0,0 +1,119 @@[m
[32m+[m[32m# BOMç”Ÿæˆç³»ç»Ÿé…ç½®æ–‡ä»¶[m
[32m+[m
[32m+[m[32mimport os[m
[32m+[m
[32m+[m[32mclass Config:[m
[32m+[m[32m    """åŸºç¡€é…ç½®ç±»"""[m
[32m+[m[41m    [m
[32m+[m[32m    # åŸºæœ¬è®¾ç½®[m
[32m+[m[32m    SECRET_KEY = os.environ.get('SECRET_KEY') or 'bom-system-secret-key-2024'[m
[32m+[m[32m    DEBUG = False[m
[32m+[m[32m    TESTING = False[m
[32m+[m[41m    [m
[32m+[m[32m    # æ•°æ®åº“è®¾ç½®[m
[32m+[m[32m    SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL') or 'sqlite:///bom_system.db'[m
[32m+[m[32m    SQLALCHEMY_TRACK_MODIFICATIONS = False[m
[32m+[m[41m    [m
[32m+[m[32m    # æ–‡ä»¶ä¸Šä¼ è®¾ç½®[m
[32m+[m[32m    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB[m
[32m+[m[32m    UPLOAD_FOLDER = 'uploads'[m
[32m+[m[41m    [m
[32m+[m[32m    # ç³»ç»Ÿè®¾ç½®[m
[32m+[m[32m    DEFAULT_FACTORY_CODE = 'P060'  # é»˜è®¤å·¥å‚ä»£ç [m
[32m+[m[32m    DEFAULT_BOM_PURPOSE = '1'      # é»˜è®¤BOMç”¨é€”[m
[32m+[m[32m    DEFAULT_BOM_STATUS = '01'      # é»˜è®¤BOMçŠ¶æ€[m
[32m+[m[32m    DEFAULT_PROJECT_CATEGORY = 'L' # é»˜è®¤é¡¹ç›®ç±»åˆ«[m
[32m+[m[41m    [m
[32m+[m[32m    # è¡Œé¡¹ç›®å·è®¾ç½®[m
[32m+[m[32m    LINE_NUMBER_START = '0010'     # è¡Œé¡¹ç›®å·èµ·å§‹å€¼[m
[32m+[m[32m    LINE_NUMBER_STEP = 10          # è¡Œé¡¹ç›®å·æ­¥é•¿[m
[32m+[m[32m    LINE_NUMBER_FORMAT = '4'       # è¡Œé¡¹ç›®å·æ ¼å¼ï¼ˆ4ä½æ•°å­—ï¼‰[m
[32m+[m[41m    [m
[32m+[m[32m    # æ•°é‡ç²¾åº¦è®¾ç½®[m
[32m+[m[32m    MAX_DECIMAL_PLACES = 3         # æœ€å¤§å°æ•°ä½æ•°[m
[32m+[m[41m    [m
[32m+[m[32m    # åˆ†é¡µè®¾ç½®[m
[32m+[m[32m    ITEMS_PER_PAGE = 20[m
[32m+[m[41m    [m
[32m+[m[32m    # æ—¥å¿—è®¾ç½®[m
[32m+[m[32m    LOG_LEVEL = 'INFO'[m
[32m+[m[32m    LOG_FILE = 'bom_system.log'[m
[32m+[m[41m    [m
[32m+[m[32m    # å®‰å…¨è®¾ç½®[m
[32m+[m[32m    SESSION_COOKIE_SECURE = False[m
[32m+[m[32m    SESSION_COOKIE_HTTPONLY = True[m
[32m+[m[32m    PERMANENT_SESSION_LIFETIME = 3600  # 1å°æ—¶[m
[32m+[m
[32m+[m[32mclass DevelopmentConfig(Config):[m
[32m+[m[32m    """å¼€å‘ç¯å¢ƒé…ç½®"""[m
[32m+[m[32m    DEBUG = True[m
[32m+[m[32m    SQLALCHEMY_DATABASE_URI = 'sqlite:///bom_system_dev.db'[m
[32m+[m
[32m+[m[32mclass ProductionConfig(Config):[m
[32m+[m[32m    """ç”Ÿäº§ç¯å¢ƒé…ç½®"""[m
[32m+[m[32m    DEBUG = False[m
[32m+[m[32m    SQLALCHEMY_DATABASE_URI = os.environ.get('DATABASE_URL')[m
[32m+[m[41m    [m
[32m+[m[32m    # ç”Ÿäº§ç¯å¢ƒå®‰å…¨è®¾ç½®[m
[32m+[m[32m    SESSION_COOKIE_SECURE = True[m
[32m+[m[32m    SESSION_COOKIE_HTTPONLY = True[m
[32m+[m
[32m+[m[32mclass TestingConfig(Config):[m
[32m+[m[32m    """æµ‹è¯•ç¯å¢ƒé…ç½®"""[m
[32m+[m[32m    TESTING = True[m
[32m+[m[32m    SQLALCHEMY_DATABASE_URI = 'sqlite:///bom_system_test.db'[m
[32m+[m
[32m+[m[32m# é…ç½®å­—å…¸[m
[32m+[m[32mconfig = {[m
[32m+[m[32m    'development': DevelopmentConfig,[m
[32m+[m[32m    'production': ProductionConfig,[m
[32m+[m[32m    'testing': TestingConfig,[m
[32m+[m[32m    'default': DevelopmentConfig[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m# é¡¹ç›®ç±»åˆ«é€‰é¡¹[m
[32m+[m[32mPROJECT_CATEGORIES = [[m
[32m+[m[32m    'L',  # å›ºå®šå€¼[m
[32m+[m[32m    'N'   # è™šæ‹Ÿä»¶[m
[32m+[m[32m][m
[32m+[m
[32m+[m[32m# BOMç”¨é€”é€‰é¡¹[m
[32m+[m[32mBOM_PURPOSES = [[m
[32m+[m[32m    '1',  # ç”Ÿäº§[m
[32m+[m[32m    '2',  # é”€å”®[m
[32m+[m[32m    '3',  # å·¥ç¨‹[m
[32m+[m[32m    '4',  # æˆæœ¬æ ¸ç®—[m
[32m+[m[32m    '5'   # å…¶ä»–[m
[32m+[m[32m][m
[32m+[m
[32m+[m[32m# BOMçŠ¶æ€é€‰é¡¹[m
[32m+[m[32mBOM_STATUSES = [[m
[32m+[m[32m    '01',  # æœ‰æ•ˆ[m
[32m+[m[32m    '02',  # æ— æ•ˆ[m
[32m+[m[32m    '03',  # å¾…å®¡æ ¸[m
[32m+[m[32m    '04'   # å·²åºŸå¼ƒ[m
[32m+[m[32m][m
[32m+[m
[32m+[m[32m# Excelå¯¼å‡ºè®¾ç½®[m
[32m+[m[32mEXCEL_SETTINGS = {[m
[32m+[m[32m    'sheet_name': 'BOMè¡¨',[m
[32m+[m[32m    'column_widths': [15, 10, 20, 20, 30, 15, 10, 10, 10, 15, 15, 15, 20, 30, 15, 15],[m
[32m+[m[32m    'header_style': {[m
[32m+[m[32m        'font': {'bold': True, 'size': 12},[m
[32m+[m[32m        'alignment': {'horizontal': 'center', 'vertical': 'center'},[m
[32m+[m[32m        'fill': {'fgColor': 'CCCCCC'}[m
[32m+[m[32m    },[m
[32m+[m[32m    'data_style': {[m
[32m+[m[32m        'font': {'size': 10},[m
[32m+[m[32m        'alignment': {'horizontal': 'left', 'vertical': 'center'}[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m# ç³»ç»Ÿä¿¡æ¯[m
[32m+[m[32mSYSTEM_INFO = {[m
[32m+[m[32m    'name': 'BOMç”Ÿæˆç³»ç»Ÿ',[m
[32m+[m[32m    'version': '1.0.0',[m
[32m+[m[32m    'description': 'è‡ªåŠ¨ç”Ÿæˆç‰©æ–™æ¸…å•è¡¨çš„Webåº”ç”¨ç³»ç»Ÿ',[m
[32m+[m[32m    'author': 'System Administrator',[m
[32m+[m[32m    'contact': 'admin@company.com'[m
[32m+[m[32m}[m
[1mdiff --git a/demo.py b/demo.py[m
[1mnew file mode 100644[m
[1mindex 0000000..c24d8bc[m
[1m--- /dev/null[m
[1m+++ b